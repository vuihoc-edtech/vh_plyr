<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VhPlyr - VUIHOC Player</title>

    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <div id="player-container">
        <!-- poster="" prevents Android WebView CORS error with default_video_poster -->
        <video id="player" playsinline controls crossorigin poster="">
            <!-- HLS source will be loaded dynamically -->
        </video>
    </div>

    <!-- HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.7/dist/hls.min.js"></script>

    <!-- Plyr -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>

    <!-- VhPlyr Bridge -->
    <script src="bridge.js"></script>

    <script>
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function () {
            // Get URL from query params or postMessage
            const urlParams = new URLSearchParams(window.location.search);
            const streamUrl = urlParams.get('url') || urlParams.get('source');

            if (streamUrl) {
                VhPlyr.loadSource(streamUrl);
            }
        });

        // Listen for postMessage from parent (iframe integration)
        window.addEventListener('message', function (event) {
            try {
                const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;

                if (data.action && typeof VhPlyr[data.action] === 'function') {
                    const result = VhPlyr[data.action].apply(VhPlyr, data.args || []);

                    // Send result back to parent
                    if (event.source) {
                        event.source.postMessage({
                            type: 'VhPlyrResponse',
                            action: data.action,
                            result: result,
                            requestId: data.requestId
                        }, '*');
                    }
                }
            } catch (e) {
                console.error('VhPlyr postMessage error:', e);
            }
        });
    </script>
</body>

</html>