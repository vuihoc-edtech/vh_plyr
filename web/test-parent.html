<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VhPlyr SDK Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        iframe { width: 100%; aspect-ratio: 16/9; border: 1px solid #ccc; }
        .controls { margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        button { padding: 10px; cursor: pointer; }
        #logs { margin-top: 20px; background: #f5f5f5; padding: 10px; height: 200px; overflow-y: auto; border: 1px solid #ddd; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>VhPlyr SDK Integration Test</h1>
        
        <!-- Embed Player -->
        <iframe id="player-iframe" src="index.html"></iframe>

        <!-- Controls -->
        <div class="controls">
            <button onclick="player.play()">Play</button>
            <button onclick="player.pause()">Pause</button>
            <button onclick="player.togglePlay()">Toggle Play</button>
            <button onclick="player.seek(30)">Seek 30s</button>
            <button onclick="player.setVolume(0.5)">Volume 50%</button>
            <button onclick="player.setMuted(true)">Mute</button>
            <button onclick="player.setMuted(false)">Unmute</button>
            <button onclick="player.toggleFullscreen()">Fullscreen</button>
            <button onclick="getStatus()">Get Status</button>
        </div>

        <div id="logs"></div>
    </div>

    <!-- Load SDK -->
    <script src="client-sdk.js"></script>

    <script>
        // Log helper
        function log(msg, data = '') {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            const dataStr = data ? JSON.stringify(data) : '';
            logs.innerHTML = `<div>[${time}] ${msg} ${dataStr}</div>` + logs.innerHTML;
        }

        // Initialize SDK
        // Note: For local testing with file://, origin is null or 'file://' depending on browser
        // In real usage, targetOrigin would be 'https://player.vuihoc.vn'
        const player = new VhPlyrClient('player-iframe', '*');

        // Listen for events
        player.on('ready', (data) => log('Event: ready', data));
        player.on('play', (data) => log('Event: play', data));
        player.on('pause', (data) => log('Event: pause', data));
        player.on('timeUpdate', (data) => {
            // Uncomment to see time updates (too spammy for simple test)
            // log('Event: timeUpdate', data.currentTime);
        });

        // Load source on start
        setTimeout(() => {
            log('Loading source...');
            player.loadSource('https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8');
        }, 1000);

        // Test Async Getters
        async function getStatus() {
            try {
                const state = await player.getState();
                log('State:', state);
                
                const time = await player.getCurrentTime();
                log('Current Time:', time);
            } catch (e) {
                log('Error getting status:', e);
            }
        }
    </script>
</body>
</html>
